/*
Team colors and logos collective connection
*/
const NBA_logo={
  'ATL': './images/NBA/nba-atlanta-hawks-logo.png',
  'BKN': './images/NBA/nba-brooklyn-nets-logo.png',
  'BOS': './images/NBA/nba-boston-celtics-logo.png',
  'CHA': './images/NBA/nba-charlotte-hornets-logo.png',
  'CHI': './images/NBA/nba-chicago-bulls-logo.png ',
  'CLE': './images/NBA/nba-cleveland-cavaliers-logo.png',
  'DAL': './images/NBA/nba-dallas-mavericks-logo.png',
  'DEN': './images/NBA/nba-denver-nuggets-logo-2018.png',
  'DET': './images/NBA/nba-detroit-pistons-logo.png   ',
  'GSW': './images/NBA/nba-golden-state-warriors-logo-2020-1024x1024.png',
  'HOU': './images/NBA/nba-houston-rockets-logo-2020.png ',
  'IND': './images/NBA/nba-indiana-pacers-logo.png ',
  'LAC': './images/NBA/nba-la-clippers-logo.png',
  'LAL': './images/NBA/nba-los-angeles-lakers-logo.png',
  'MEM': './images/NBA/nba-memphis-grizzlies-logo-1024x1024.png',
  'MIA': './images/NBA/nba-miami-heat-logo.png',
  'MIL': './images/NBA/nba-milwaukee-bucks-logo.png',
  'MIN': './images/NBA/nba-minnesota-timberwolves-logo.png',
  'NOP': './images/NBA/nba-new-orleans-pelicans-logo.png',
  'NYK': './images/NBA/nba-new-york-knicks-logo.png',
  'OKC': './images/NBA/nba-oklahoma-city-thunder-logo.png',
  'ORL': './images/NBA/nba-orlando-magic-logo.png  ',
  'PHI': './images/NBA/nba-philadelphia-76ers-logo.png',
  'PHX': './images/NBA/nba-phoenix-suns-logo.png',
  'POR': './images/NBA/nba-portland-trail-blazers-logo.png',
  'SAC': './images/NBA/nba-sacramento-kings-logo.png',
  'SAS': './images/NBA/nba-san-antonio-spurs-logo.png',
  'TOR': './images/NBA/nba-toronto-raptors-logo-2020-1024x1024.png',
  'UTA': './images/NBA/nba-utah-jazz-logo.png',
  'WAS': './images/NBA/nba-washington-wizards-logo.png',
};

const NBA_fullname = {
  'ATL': 'Atlanta Hawks',
  'BKN': 'Brooklyn Nets',
  'BOS': 'Boston Celtics',
  'CHA': 'Charlotte Hornets',
  'CHI': 'Chicago Bulls',
  'CLE': 'Cleveland Cavaliers',
  'DAL': 'Dallas Mavericks',
  'DEN': 'Denver Nuggets',
  'DET': 'Detroit Pistons',
  'GSW': 'Golden State Warriors',
  'HOU': 'Houston Rockets',
  'IND': 'Indiana Pacers',
  'LAC': 'Los Angeles Clippers',
  'LAL': 'Los Angeles Lakers',
  'MEM': 'Memphis Grizzlies',
  'MIA': 'Miami Heat',
  'MIL': 'Milwaukee Bucks',
  'MIN': 'Minnesota Timberwolves',
  'NOP': 'New Orleans Pelicans',
  'NYK': 'New York Knicks',
  'OKC': 'Oklahoma City Thunder',
  'ORL': 'Orlando Magic',
  'PHI': 'Philadelphia 76ers',
  'PHX': 'Phoenix Suns',
  'POR': 'Portland Trail Blazers',
  'SAC': 'Sacramento Kings',
  'SAS': 'San Antonio Spurs',
  'TOR': 'Toronto Raptors',
  'UTA': 'Utah Jazz',
  'WAS': 'Washington Wizards'
};

const NBA_color = {
  "ATL": "#E03A3E",
  "BOS": "#007A33",
  "BKN": "#000000",
  "CHA": "#1D1160",
  "CHI": "#CE1141",
  "CLE": "#6F263D",
  "DAL": "#00538C",
  "DEN": "#0E2240",
  "DET": "#001F70",
  "GSW": "#1D428A",
  "HOU": "#CE1141",
  "IND": "#002D62",
  "LAC": "#ED174C",
  "LAL": "#FDB927",
  "MEM": "#5D76A9",
  "MIA": "#98002E",
  "MIL": "#00471B",
  "MIN": "#0C2340",
  "NOP": "#002B5C",
  "NYK": "#006BB6",
  "OKC": "#007AC1",
  "ORL": "#0077C0",
  "PHI": "#006BB6",
  "PHX": "#1D1160",
  "POR": "#E03A3E",
  "SAC": "#5A2D81",
  "SAS": "#C4CED3",
  "TOR": "#CE1141",
  "UTA": "#002B5C",
  "WAS": "#E31837"
};

const NFL_logo={
  "Arizona Cardinals" : "./images\\NFL\\Cardinals_logo.svg.png",
  "Atlanta Falcons" : "./images\\NFL\\Falcons_logo.svg.png",
  "Baltimore Ravens" : "./images\\NFL\\Ravens_logo.svg.png",
  "Buffalo Bills" : "./images\\NFL\\Bills_logo.svg.png",
  "Carolina Panthers" : "./images\\NFL\\Panthers_logo.svg.png",
  "Chicago Bears" : "./images\\NFL\\Bears_logo.svg.png",
  "Cincinnati Bengals" : "./images\\NFL\\Bengals_logo.svg.png",
  "Cleveland Browns" : "./images\\NFL\\Browns_logo.svg.png",
  "Dallas Cowboys" : "./images\\NFL\\Cowboys_logo.svg.png",
  "Denver Broncos" : "./images\\NFL\\Broncos_logo.svg.png",
  "Detroit Lions" : "./images\\NFL\\Lions_logo.svg.png",
  "Green Bay Packers" : "./images\\NFL\\Packers_logo.svg.png",
  "Houston Texans" : "./images\\NFL\\Texans_logo.svg.png",
  "Indianapolis Colts" : "./images\\NFL\\Colts_logo.svg.png",
  "Jacksonville Jaguars" : "./images\\NFL\\Jaguars_logo.svg.png",
  "Kansas City Chiefs" : "./images\\NFL\\Chiefs_logo.svg.png",
  "Las Vegas Raiders" : "./images\\NFL\\Raiders_logo.svg.png",
  "Los Angeles Chargers" : "./images\\NFL\\Chargers_logo.svg.png",
  "Los Angeles Rams" : "./images\\NFL\\Rams_logo.svg.png",
  "Miami Dolphins" : "./images\\NFL\\Dolphins_logo.svg.png",
  "Minnesota Vikings" : "./images\\NFL\\Vikings_logo.svg.png",
  "New England Patriots" : "./images\\NFL\\Patriots_logo.svg.png",
  "New Orleans Saints" : "./images\\NFL\\Saints_logo.svg.png",
  "New York Giants" : "./images\\NFL\\Giants_logo.svg.png",
  "New York Jets" : "./images\\NFL\\Jets_logo.svg.png",
  "Philadelphia Eagles" : "./images\\NFL\\Eagles_logo.svg.png",
  "Pittsburgh Steelers" : "./images\\NFL\\Steelers_logo.svg.png",
  "San Francisco 49ers" : "./images\\NFL\\49ers_logo.svg.png",
  "Seattle Seahawks" : "./images\\NFL\\Seahawks_logo.svg.png",
  "Tampa Bay Buccaneers" : "./images\\NFL\\Buccaneers_logo.svg.png",
  "Tennessee Titans" : "./images\\NFL\\Titans_logo.svg.png",
  "Washington Commanders" : "./images\\NFL\\Commanders_logo.svg.png"
}

const NFL_color={
  "Arizona Cardinals" : "#97233F",
  "Atlanta Falcons" : "#A71930",
  "Baltimore Ravens" : "#241773",
  "Buffalo Bills" : "#00338D",
  "Carolina Panthers" : "#0085CA",
  "Chicago Bears" : "#03202F",
  "Cincinnati Bengals" : "#FB4F14",
  "Cleveland Browns" : "#311D00",
  "Dallas Cowboys" : "#003594",
  "Denver Broncos" : "#FB4F14",
  "Detroit Lions" : "#0076B6",
  "Green Bay Packers" : "#203731",
  "Houston Texans" : "#03202F",
  "Indianapolis Colts" : "#002C5F",
  "Jacksonville Jaguars" : "#006778",
  "Kansas City Chiefs" : "#E31837",
  "Las Vegas Raiders" : "#000000",
  "Los Angeles Chargers" : "#0080C6",
  "Los Angeles Rams" : "#002244",
  "Miami Dolphins" : "#008E97",
  "Minnesota Vikings" : "#4F2683",
  "New England Patriots" : "#002244",
  "New Orleans Saints" : "#D3BC8D",
  "New York Giants" : "#0B2265",
  "New York Jets" : "#003F2D",
  "Philadelphia Eagles" : "#004C54",
  "Pittsburgh Steelers" : "#FFB612",
  "San Francisco 49ers" : "#AA0000",
  "Seattle Seahawks" : "#002244",
  "Tampa Bay Buccaneers" : "#D50A0A",
  "Tennessee Titans" : "#4B92DB",
  "Washington Commanders" : "#773141"
}

function toggle(e){
  console.log(e);
  if(e.classList.contains("hidden")) e.classList.remove("hidden");
  else e.classList.add("hidden");
}

/*
Main mechanism to switch between tabs
*/
function hide_body_pages_except(e){
  Array.from(document.getElementsByClassName("body-page")).forEach(element => {
    if(!element.classList.contains("hidden")) element.classList.add("hidden");
  });
  e.classList.remove("hidden");
}

/*
Home page shows upcoming matches
*/
function home_page(){
  const homepage = document.getElementById('home-page');

  $.ajax({
    type: "GET",
    url: "./api/user/fetch_nba_upcoming.php",
  })
    .done(function( response ) {
      // Update the page content with the response from the server
      picks_table = JSON.parse(response);
    });
    $(document).ajaxStop(function() {
      for(let row=0; row<picks_table.length; row++){

        if(row==0||picks_table[row]['date_'] != picks_table[row-1]['date_']){
          var divDate = document.createElement('div');
          divDate.classList.add('tabs');
          var year = picks_table[row]['date_'].slice(0,-6);
          var month ="";
          if (picks_table[row]['date_'].slice(5, -3) == 03){
            month = "March";
          }else{
            month = "April";
          }
          var day = picks_table[row]['date_'].slice(8);

          
          divDate.innerHTML = month +" "+day+", "+year;

          homepage.appendChild(divDate);
        }

        team1 = picks_table[row]['away_team'];
        team2 = picks_table[row]['home_team'];

        //spacer
        let aDiv = document.createElement('div');
        aDiv.classList.add('spacer');
        let aDiv2 = document.createElement('div');
        aDiv2.classList.add('spacer');
  
        const newDiv = document.createElement("div");
        newDiv.classList.add("match-teams");
        
        //team 1's div
        //frame
        const t1Div = document.createElement("div");
        t1Div.classList.add("team");
        t1Div.setAttribute("id","team1");
        t1Div.style.background = NBA_color[team1];
        //get logo
        const t1Img = document.createElement("img");
        t1Img.classList.add("logo");
        t1Img.setAttribute("id","team1-logo");
        t1Img.setAttribute("src",NBA_logo[team1]);
        //get name
        const t1Label = document.createElement("label");
        t1Label.classList.add("team-name");
        t1Label.setAttribute("id","team1-name");
        t1Label.textContent = NBA_fullname[team1];

        t1Div.appendChild(t1Img);
        t1Div.appendChild(t1Label);
        t1Div.appendChild(aDiv2);

        //team 2's div
        //frame
        const t2Div = document.createElement("div");
        t2Div.classList.add("team");
        t2Div.setAttribute("id","team2");
        t2Div.style.background = NBA_color[team2];
        //get logo
        const t2Img = document.createElement("img");
        t2Img.classList.add("logo");
        t2Img.setAttribute("id","team2-logo");
        t2Img.setAttribute("src",NBA_logo[team2]);
        //get name
        const t2Label = document.createElement("label");
        t2Label.classList.add("team-name");
        t2Label.setAttribute("id","team2-name");
        t2Label.textContent = NBA_fullname[team2];

        //time
        const timeDiv = document.createElement('div');
        timeDiv.classList.add('nba-time');
        timeDiv.innerHTML = picks_table[row]['time_'].slice(0,-3) + "PM";

        
        
        t2Div.appendChild(aDiv);
        t2Div.appendChild(t2Label);
        t2Div.appendChild(t2Img);

        newDiv.appendChild(t1Div);
        newDiv.appendChild(timeDiv);
        newDiv.appendChild(t2Div);

        homepage.appendChild(newDiv);


      }

    });
}

/*
Fetch NFL picks from the database then create and add HTML tags into index.html
*/
function NFL_picks_fetch(){
  const NFL_picks = document.getElementById("NFL-picks");
  hide_body_pages_except(NFL_picks);


  if(NFL_picks.children.length<1){
    var picks_table;
    $.ajax({
      type: "GET",
      url: "./api/user/fetch_nfl_picks.php",
    })
      .done(function( response ) {
        // Update the page content with the response from the server
        picks_table = JSON.parse(response);
      });
      $(document).ajaxStop(function() {

        for(let row=0; row<picks_table.length; row++){
          if(row==0 || picks_table[row]['team'] != picks_table[row-1]['team']){
  
            var divTeamNbaPicks = document.createElement('div');
            divTeamNbaPicks.classList.add('team-nba-picks');
  
            const divRowNba1 = document.createElement('div');
            divRowNba1.classList.add('row-nba');
            divRowNba1.style.background=NFL_color[picks_table[row]['team']];
  
            const divRowNbaNameLogo = document.createElement('div');
            divRowNbaNameLogo.classList.add('row-nba', 'name+logo');
  
            const imgLogo = document.createElement('img');
            imgLogo.classList.add('logo');
            imgLogo.src = NFL_logo[String(picks_table[row]['team'])] ;
  
            const h1TeamName = document.createElement('h1');
            h1TeamName.innerText = String(picks_table[row]['team']);
  
            const divRowNbaSpread = document.createElement('div');
            divRowNbaSpread.classList.add('row-nba', 'nba-spread');
  
            const h4Spread = document.createElement('h4');
            h4Spread.innerText = 'Spread';
  
            const h4SpreadBy = document.createElement('h4');
            h4SpreadBy.innerText = 'Spread By';
  
            const h4Inj = document.createElement('h4');
            h4Inj.innerText = 'Inj';
            
            divRowNbaNameLogo.appendChild(imgLogo);
            divRowNbaNameLogo.appendChild(h1TeamName);
            divRowNbaSpread.appendChild(h4Spread);
            divRowNbaSpread.appendChild(h4SpreadBy);
            divRowNbaSpread.appendChild(h4Inj);
            divRowNba1.appendChild(divRowNbaNameLogo);
            divRowNba1.appendChild(divRowNbaSpread);
            divTeamNbaPicks.appendChild(divRowNba1);
          }//end if
          
          
          if(row==0 || picks_table[row]['week'] != picks_table[row-1]['week']){
            var labelWeek = document.createElement('label');
            labelWeek.classList.add('tabs');
            labelWeek.innerHTML = "Week " + String(picks_table[row]['week']);
            NFL_picks.appendChild(labelWeek);
            
            var divWeekNbaPicks = document.createElement('div');
            divWeekNbaPicks.classList.add('week-nba-picks');
          }
          
          const divRowNba2 = document.createElement('div');
          divRowNba2.classList.add('row-nba');
  
          const h3PickType = document.createElement('h3');
          h3PickType.innerText = String(picks_table[row]['picktype']);
  
          const divStatNba1 = document.createElement('div');
          divStatNba1.classList.add('row-nba', 'stat-nba');
  
          const h4StatNba1 = document.createElement('h4');
          h4StatNba1.innerText = String(picks_table[row]['spread']);
  
          const h4StatNba2 = document.createElement('h4');
          h4StatNba2.innerText = String(picks_table[row]['spreadby']);
  
          const h4StatNba3 = document.createElement('h4');
          h4StatNba3.innerText = String(picks_table[row]['inj']);
  
          divStatNba1.appendChild(h4StatNba1);
          divStatNba1.appendChild(h4StatNba2);
          divStatNba1.appendChild(h4StatNba3);
          divRowNba2.appendChild(h3PickType);
          divRowNba2.appendChild(divStatNba1);
          divTeamNbaPicks.appendChild(divRowNba2);


          
          if(row==0 || picks_table[row]['team'] != picks_table[row-1]['team']){
            divWeekNbaPicks.appendChild(divTeamNbaPicks);
          }

          if(row==0 || picks_table[row]['week'] != picks_table[row-1]['week']){
            NFL_picks.appendChild(divWeekNbaPicks);
          }
        }
      })
  }
}

/*
Fetch NBA picks from the database then create and add HTML tags into index.html
*/
function NBA_picks_fetch(){
  const NBA_picks = document.getElementById("NBA-picks");
  hide_body_pages_except(NBA_picks);

  if(NBA_picks.children.length<1){
    
    var picks_table;
    $.ajax({
      type: "GET",
      url: "./api/user/fetch_nba_picks.php",
    })
      .done(function( response ) {
        // Update the page content with the response from the server
        picks_table = JSON.parse(response);
      });
      $(document).ajaxStop(function() {


        for(let row=0; row<picks_table.length; row++){
          if(row==0 || picks_table[row]['team'] != picks_table[row-1]['team']){
  
            var divTeamNbaPicks = document.createElement('div');
            divTeamNbaPicks.classList.add('team-nba-picks');
  
            const divRowNba1 = document.createElement('div');
            divRowNba1.classList.add('row-nba');
            divRowNba1.style.background=NBA_color[picks_table[row]['team']];
  
            const divRowNbaNameLogo = document.createElement('div');
            divRowNbaNameLogo.classList.add('row-nba', 'name+logo');
  
            const imgLogo = document.createElement('img');
            imgLogo.classList.add('logo');
            imgLogo.src = NBA_logo[String(picks_table[row]['team'])] ;
  
            const h1TeamName = document.createElement('h1');
            h1TeamName.innerText = NBA_fullname[String(picks_table[row]['team'])];
  
            const divRowNbaSpread = document.createElement('div');
            divRowNbaSpread.classList.add('row-nba', 'nba-spread');
  
            const h4Spread = document.createElement('h4');
            h4Spread.innerText = 'Spread';
  
            const h4SpreadBy = document.createElement('h4');
            h4SpreadBy.innerText = 'Spread By';
  
            const h4Inj = document.createElement('h4');
            h4Inj.innerText = 'Inj';
            
            divRowNbaNameLogo.appendChild(imgLogo);
            divRowNbaNameLogo.appendChild(h1TeamName);
            divRowNbaSpread.appendChild(h4Spread);
            divRowNbaSpread.appendChild(h4SpreadBy);
            divRowNbaSpread.appendChild(h4Inj);
            divRowNba1.appendChild(divRowNbaNameLogo);
            divRowNba1.appendChild(divRowNbaSpread);
            divTeamNbaPicks.appendChild(divRowNba1);
          }//end if
          
          
          if(row==0 || picks_table[row]['date'] != picks_table[row-1]['date']){
            var labelWeek = document.createElement('label');
            labelWeek.classList.add('tabs');
            labelWeek.innerHTML = String(picks_table[row]['date']);
            NBA_picks.appendChild(labelWeek);
            
            var divWeekNbaPicks = document.createElement('div');
            divWeekNbaPicks.classList.add('week-nba-picks');
          }
          
          const divRowNba2 = document.createElement('div');
          divRowNba2.classList.add('row-nba');
  
          const h3PickType = document.createElement('h3');
          h3PickType.innerText = String(picks_table[row]['picktype']) +":";
  
          const divStatNba1 = document.createElement('div');
          divStatNba1.classList.add('row-nba', 'stat-nba');
  
          const h4StatNba1 = document.createElement('h4');
          h4StatNba1.innerText = String(picks_table[row]['spread']);
  
          const h4StatNba2 = document.createElement('h4');
          h4StatNba2.innerText = String(picks_table[row]['spreadby']);
  
          const h4StatNba3 = document.createElement('h4');
          h4StatNba3.innerText = String(picks_table[row]['inj5']);
  
          divStatNba1.appendChild(h4StatNba1);
          divStatNba1.appendChild(h4StatNba2);
          divStatNba1.appendChild(h4StatNba3);
          divRowNba2.appendChild(h3PickType);
          divRowNba2.appendChild(divStatNba1);
          divTeamNbaPicks.appendChild(divRowNba2);


          
          if(row==0 || picks_table[row]['team'] != picks_table[row-1]['team']){
            divWeekNbaPicks.appendChild(divTeamNbaPicks);
          }

          if(row==0 || picks_table[row]['date'] != picks_table[row-1]['date']){
            NBA_picks.appendChild(divWeekNbaPicks);
          }
        }
      })
  }
}

function all_picks_fetch(){
  NBA_picks_fetch()
  NFL_picks_fetch()
  document.getElementById("NBA-picks").classList.remove("hidden");
}

function NFL_page(){
  var NFL = document.getElementById("NFL-sport");
  hide_body_pages_except(NFL);
  //TODO: Implement this
}

function NBA_page(){
  var NBA = document.getElementById("NBA-sport");
  hide_body_pages_except(NBA);
  //TODO: Implement this
  //experiment
  let live_match = NBA_match_live_display('CHI','45','DAL','80'); 
  document.getElementById("NBA-live").appendChild(live_match);

}

function show_user_info(){
  var user = document.getElementById("user-info");
  hide_body_pages_except(user);
  //TODO: Implement this
}

function NBA_match_live_display(team1, t1_score, team2, t2_score){
  const newDiv = document.createElement("div");
  newDiv.classList.add("match-teams");
  
  //team 1's div
  //frame
  const t1Div = document.createElement("div");
  t1Div.classList.add("team");
  t1Div.setAttribute("id","team1");
  t1Div.style.background = NBA_color[team1];
  //get logo
  const t1Img = document.createElement("img");
  t1Img.classList.add("logo");
  t1Img.setAttribute("id","team1-logo");
  t1Img.setAttribute("src",NBA_logo[team1]);
  //get name
  const t1Label = document.createElement("label");
  t1Label.classList.add("team-name");
  t1Label.setAttribute("id","team1-name");
  t1Label.textContent = NBA_fullname[team1];

  //score
  const t1score = document.createElement("label");
  t1score.classList.add("team-score");
  t1score.setAttribute("id","team1-score");
  t1score.textContent = t1_score;

  t1Div.appendChild(t1Img);
  t1Div.appendChild(t1Label);
  t1Div.appendChild(t1score);

  //team 2's div
  //frame
  const t2Div = document.createElement("div");
  t2Div.classList.add("team");
  t2Div.setAttribute("id","team2");
  t2Div.style.background = NBA_color[team2];
  //get logo
  const t2Img = document.createElement("img");
  t2Img.classList.add("logo");
  t2Img.setAttribute("id","team2-logo");
  t2Img.setAttribute("src",NBA_logo[team2]);
  //get name
  const t2Label = document.createElement("label");
  t2Label.classList.add("team-name");
  t2Label.setAttribute("id","team2-name");
  t2Label.textContent = NBA_fullname[team2];

  //score
  const t2score = document.createElement("label");
  t2score.classList.add("team-score");
  t2score.setAttribute("id","team2-score");
  t2score.textContent = t2_score;

  t2Div.appendChild(t2score);
  t2Div.appendChild(t2Label);
  t2Div.appendChild(t2Img);

  newDiv.appendChild(t1Div);
  newDiv.appendChild(t2Div);

  return newDiv;
}

document.addEventListener('DOMContentLoaded', function() {
  home_page();
});